<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="wrapper">
  <div class="card">
    <div class="mb-4" style="display: flex; justify-content: space-between; align-items: center;">
      <h2 style="margin: 0; font-size: 2rem; font-weight: bold;">Client Management</h2>
      <p-button 
        label="Add New Client" 
        icon="pi pi-plus" 
        (onClick)="openNew()"
      ></p-button>
    </div>

    <p-table [value]="clients" [paginator]="true" [rows]="10" [tableStyle]="{'min-width': '60rem'}">
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 18%">Name</th>
          <th style="width: 15%">Contact Number</th>
          <th style="width: 20%">Email</th>
          <th style="width: 15%">City/Municipality</th>
          <th style="width: 17%">Barangay</th>
          <th style="width: 12%">Date Created</th>
          <th style="width: 8%">Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-client>
        <tr>
          <td>{{ client.name }}</td>
          <td>{{ client.contactNumber }}</td>
          <td>{{ client.email }}</td>
          <td>{{ client.city }}</td>
          <td>{{ client.barangay }}</td>
          <td>{{ client.dateCreated | date:'short' }}</td>
          <td>
            <p-button 
              icon="pi pi-pencil" 
              [rounded]="true"
              [text]="true"
              severity="info"
              (onClick)="editClient(client)"
              ariaLabel="Edit client"
            ></p-button>
            <p-button 
              icon="pi pi-trash" 
              [rounded]="true"
              [text]="true"
              severity="danger"
              (onClick)="deleteClient(client)"
              ariaLabel="Delete client"
            ></p-button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Add/Edit Dialog -->
  <p-dialog 
    [(visible)]="displayDialog" 
    [header]="isEdit ? 'Edit Client' : 'Add New Client'"
    [modal]="true"
    [style]="{width: '650px'}"
    [draggable]="false"
    [resizable]="false"
  >
    <div style="padding: 1rem;">
      <!-- Name Field -->
      <div style="margin-bottom: 1.5rem;">
        <label for="clientName" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Full Name *</label>
        <input 
          pInputText 
          id="clientName"
          name="clientName"
          [(ngModel)]="client.name" 
          style="width: 100%; padding: 0.75rem; font-size: 1rem;"
          placeholder="Enter full name"
          autocomplete="name"
          required
        />
      </div>
      
      <!-- Contact Number Field -->
      <div style="margin-bottom: 1.5rem;">
        <label for="clientContactNumber" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Contact Number *</label>
        <input 
          pInputText 
          id="clientContactNumber"
          name="contactNumber"
          [(ngModel)]="client.contactNumber" 
          style="width: 100%; padding: 0.75rem; font-size: 1rem;"
          placeholder="09XXXXXXXXX"
          autocomplete="tel"
          required
        />
        <small style="color: #6c757d; display: block; margin-top: 0.25rem;">Format: 09XXXXXXXXX (11 digits)</small>
      </div>
      
      <!-- Email Field -->
      <div style="margin-bottom: 1.5rem;">
        <label for="clientEmail" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Email Address *</label>
        <input 
          pInputText 
          id="clientEmail"
          name="email"
          [(ngModel)]="client.email" 
          style="width: 100%; padding: 0.75rem; font-size: 1rem;"
          type="email"
          placeholder="example@gmail.com"
          autocomplete="email"
          required
        />
      </div>

      <!-- City/Municipality Field -->
      <div style="margin-bottom: 1.5rem;">
        <label for="clientCity" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">City/Municipality (Cebu) *</label>
        <p-select
          inputId="clientCity"
          name="city"
          [(ngModel)]="client.city"
          [options]="cebuCities"
          placeholder="Select City/Municipality"
          (onChange)="onCityChange()"
          styleClass="w-full"
          [filter]="true"
          filterPlaceholder="Search City"
          autocomplete="address-level2"
        ></p-select>
      </div>

      <!-- Barangay Field -->
      <div style="margin-bottom: 1.5rem;">
        <label for="clientBarangay" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Barangay/Street *</label>
        <p-select
          inputId="clientBarangay"
          name="barangay"
          [(ngModel)]="client.barangay"
          [options]="filteredBarangays"
          placeholder="Select Barangay"
          styleClass="w-full"
          [filter]="true"
          filterPlaceholder="Search Barangay"
          [disabled]="!client.city"
          autocomplete="address-level3"
        ></p-select>
        <small style="color: #6c757d; display: block; margin-top: 0.25rem;" *ngIf="!client.city">Please select a city first</small>
      </div>
    </div>
    
    <ng-template pTemplate="footer">
      <p-button 
        label="Cancel" 
        severity="secondary"
        icon="pi pi-times"
        (onClick)="displayDialog = false"
        [outlined]="true"
        styleClass="mr-2"
      ></p-button>
      <p-button 
        label="Save Client" 
        icon="pi pi-check"
        (onClick)="saveClient()"
      ></p-button>
    </ng-template>
  </p-dialog>
</div>
